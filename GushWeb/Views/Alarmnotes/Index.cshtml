@model IEnumerable<t_alarmnotes>

@{
    ViewBag.Title = "Index";

    var ajaxOption = new AjaxOptions
    {
        UpdateTargetId = "tb",
        LoadingElementId = "loading",
        HttpMethod = "POST",
        //Confirm = "确认提交？",
        OnBegin = "onBegin()",
        OnSuccess = "onSuccess()",
        OnFailure = "onFailure()",
        OnComplete = "onComplete()",
        InsertionMode = InsertionMode.InsertAfter
    };
}
@using (Ajax.BeginForm("IndexAsyn", ajaxOption))
{
    <table class="table" name="list">
        <thead>
        <tr>
            <th></th>
            <th>
                @Html.DisplayNameFor(model => model.Code)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Name)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Price)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Time)
            </th>
            <th></th>
        </tr>
        </thead>
        <tbody id="tb">
            @Html.Partial("pviewIndex", Model)
        </tbody>
    </table>
}
@section scripts
{
    <script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>
    <script src="~/Scripts/stockData.js"></script>
    <script>
        function onBegin() {
        }

        function onSuccess() {
        }

        function onFailure() {
        }

        function onComplete() {
        }

        //function insertAsyn() {
        //    $("form").submit();
        //}

        var timer = setInterval(function () { $("form").submit(); }, 9000);
        (function() {
            updateDataChange(getCodes, updateChange, 6000);
        })()

        function updateChange(code, price, change) {
            $("span").each(function() {
                if ($(this).attr("name") == code) {
                    var tagPrice = parseFloat($(this).attr("tag"));
                    if (tagPrice.isNaN) tagPrice=0;
                    var color = tagPrice > price ? "green" : "red";
                    $(this).html(change);
                    $(this).css("color", color);
                }
            });
        }

        function getCodes() {
            var arry = new Array();
            $("[type=hidden][name='codes']").each(function() {
                arry.push($(this).val());
            });
            return arry;
        }
    </script>
}
